<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Bowl 60 Score Prediction Game</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #1a2332;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .header p {
            font-size: 1.2em;
            color: #5a6c7d;
        }

        .read-more-link {
            color: #1a2332;
            text-decoration: underline;
            cursor: pointer;
            margin-left: 8px;
            font-size: 0.9em;
            transition: opacity 0.2s;
        }

        .read-more-link:hover {
            opacity: 0.7;
        }

        .super-bowl-logo {
            height: 50px;
            vertical-align: middle;
        }

        .team-logo-inline {
            height: 30px;
            vertical-align: middle;
        }

        .info-modal-content {
            max-width: 600px;
        }

        .info-modal-content h3 {
            color: #1a2332;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .info-modal-content ul {
            margin-left: 20px;
            line-height: 1.8;
        }

        .info-modal-content p {
            line-height: 1.6;
            color: #5a6c7d;
        }

        .teams-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            align-items: center;
        }

        .team-info-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .live-score {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 30px 20px;
            background: linear-gradient(135deg, #1a2332 0%, #2d3e50 100%);
            border-radius: 10px;
            color: white;
            margin-bottom: 20px;
        }

        .team {
            text-align: center;
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .team-logo {
            width: 80px;
            height: 80px;
            object-fit: contain;
        }

        .team-name {
            font-size: 1.3em;
            font-weight: bold;
        }

        .team-score {
            font-size: 3em;
            font-weight: bold;
        }

        .vs {
            font-size: 1.5em;
            font-weight: 600;
            padding: 0 20px;
            color: #9ca9b8;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section h2 {
            color: #1a2332;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .prediction-form {
            display: grid;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }

        .form-group input,
        .form-group select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #1a2332;
        }

        .score-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn {
            background: #1a2332;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(26, 35, 50, 0.3);
            background: #2d3e50;
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #5a6c7d;
            margin-left: 10px;
        }

        .btn-secondary:hover {
            background: #6b7d8e;
        }

        .predictions-list {
            margin-top: 20px;
        }

        .rank-change {
            animation: highlightRank 0.6s ease-out;
        }

        @keyframes highlightRank {
            0%, 100% {
                background: transparent;
            }
            50% {
                background: rgba(255, 193, 7, 0.2);
            }
        }

        .prediction-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #5a6c7d;
            position: relative;
            animation: slideInList 0.4s ease-out backwards;
            transition: all 0.3s ease;
        }

        .prediction-item.winner {
            background: #e8f5e9;
            border-left-color: #4caf50;
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
        }

        .prediction-item.winner .prediction-name {
            font-size: 1.35em;
        }

        @keyframes slideInList {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .prediction-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .prediction-item.winner:hover {
            transform: scale(1.02) translateX(5px);
        }

        .prediction-info {
            flex: 1;
        }

        .menu-btn {
            background: none;
            border: none;
            font-size: 1.3em;
            color: #5a6c7d;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background 0.2s;
            position: relative;
        }

        .menu-btn:hover {
            background: #e0e0e0;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            right: 10px;
            top: 45px;
            background: white;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            min-width: 120px;
            z-index: 100;
            overflow: hidden;
        }

        .dropdown-menu.show {
            display: block;
            animation: fadeIn 0.2s;
        }

        .dropdown-item {
            padding: 10px 15px;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 0.9em;
            color: #dc3545;
            transition: background 0.2s;
        }

        .dropdown-item:hover {
            background: #f8f9fa;
        }

        .prediction-name {
            font-weight: 700;
            font-size: 1.2em;
            color: #333;
            margin-bottom: 5px;
        }

        .prediction-details {
            color: #666;
            font-size: 0.95em;
        }

        .prediction-score {
            text-align: right;
            font-weight: 600;
        }

        .score-diff {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .winner-badge {
            background: #28a745;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-left: 10px;
        }

        .manual-score {
            display: none;
            grid-template-columns: 1fr 1fr auto;
            gap: 10px;
            align-items: end;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px dashed #e0e0e0;
        }

        .manual-score.active {
            display: grid;
        }

        .refresh-info {
            text-align: center;
            color: #666;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .error-message {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .retry-btn {
            background: #856404;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.85em;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }

        .retry-btn:hover {
            background: #6d5003;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #5a6c7d;
        }

        .empty-icon {
            font-size: 4em;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        .empty-state h3 {
            color: #1a2332;
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .empty-state p {
            font-size: 1em;
            margin-bottom: 25px;
            opacity: 0.8;
        }

        .empty-state-btn {
            background: #1a2332;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
        }

        .empty-state-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(26, 35, 50, 0.3);
            background: #2d3e50;
        }

        .game-info {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            flex-wrap: wrap;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-label {
            font-size: 0.9em;
            color: #666;
            font-weight: 600;
        }

        .info-value {
            font-size: 1em;
            color: #333;
            font-weight: 700;
        }

        .info-separator {
            color: #999;
            font-weight: 300;
        }

        .api-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9em;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-success {
            background: #28a745;
        }

        .status-loading {
            background: #ffc107;
        }

        .status-error {
            background: #dc3545;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .last-update {
            color: #666;
            font-size: 0.85em;
        }

        .manual-switch-btn {
            background: none;
            border: none;
            color: #5a6c7d;
            font-size: 0.85em;
            cursor: pointer;
            text-decoration: underline;
            padding: 5px 8px;
            margin-left: 10px;
            transition: color 0.2s;
        }

        .manual-switch-btn:hover {
            color: #1a2332;
        }

        .add-prediction-btn {
            background: #1a2332;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
        }

        .add-prediction-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(26, 35, 50, 0.3);
            background: #2d3e50;
        }

        .rankings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .rankings-header h2 {
            margin: 0;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideIn 0.3s;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #1a2332;
            font-size: 1.5em;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .close-btn:hover {
            background: #f0f0f0;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .left-panel h2 {
            color: #1a2332;
            font-size: 1.3em;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .right-panel h2 {
            color: #1a2332;
            font-size: 1.5em;
            margin-bottom: 15px;
            font-weight: 600;
        }

        @media (max-width: 968px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .team-name {
                font-size: 1.2em;
            }

            .team-score {
                font-size: 2em;
            }

            .score-inputs {
                grid-template-columns: 1fr;
            }

            .manual-score {
                grid-template-columns: 1fr;
            }

            .btn-secondary {
                margin-left: 0;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <img src="https://a.espncdn.com/i/teamlogos/leagues/500/nfl.png" alt="NFL Logo" class="super-bowl-logo">
                Super Bowl LX
            </h1>
            <p>
                Predict the Super Bowl score!
                <a class="read-more-link" onclick="openInfoModal()">How to play</a>
            </p>
        </div>

        <div class="main-grid">
            <!-- Left Panel: Score & Game Info -->
            <div class="left-panel">
                <div class="card">
                    <div class="live-score" id="liveScore">
                        <div class="team">
                            <img src="https://a.espncdn.com/i/teamlogos/nfl/500/scoreboard/sea.png" alt="Seahawks" class="team-logo">
                            <div class="team-name">Seahawks</div>
                            <div class="team-score" id="seahawksScore">-</div>
                        </div>
                        <div class="vs">VS</div>
                        <div class="team">
                            <img src="https://a.espncdn.com/i/teamlogos/nfl/500/scoreboard/ne.png" alt="Patriots" class="team-logo">
                            <div class="team-name">Patriots</div>
                            <div class="team-score" id="patriotsScore">-</div>
                        </div>
                    </div>

                    <div class="game-info">
                        <div class="info-item">
                            <div class="info-label">Quarter</div>
                            <div class="info-value" id="quarterInfo">-</div>
                        </div>
                        <span class="info-separator">‚Ä¢</span>
                        <div class="info-item">
                            <div class="info-label">Clock</div>
                            <div class="info-value" id="clockInfo">-</div>
                        </div>
                        <span class="info-separator">‚Ä¢</span>
                        <div class="info-item">
                            <div class="info-label">Status</div>
                            <div class="info-value" id="detailedStatus">Scheduled</div>
                        </div>
                    </div>

                    <div class="api-status">
                        <div class="status-indicator status-loading" id="statusIndicator"></div>
                        <span id="apiStatusText">Initializing...</span>
                        <span class="last-update" id="lastUpdate"></span>
                        <button class="manual-switch-btn" id="manualSwitchBtn" onclick="toggleScoreMode()">Having trouble? Enter manual</button>
                    </div>

                    <div class="manual-score">
                        <div class="form-group">
                            <label>Seahawks Score (Manual)</label>
                            <input type="number" id="manualSeahawks" placeholder="Enter score">
                        </div>
                        <div class="form-group">
                            <label>Patriots Score (Manual)</label>
                            <input type="number" id="manualPatriots" placeholder="Enter score">
                        </div>
                        <button class="btn btn-secondary" onclick="updateManualScore()">Manual Update</button>
                    </div>
                    <div id="apiError"></div>
                </div>
            </div>

            <!-- Right Panel: Predictions -->
            <div class="right-panel">
                <div class="card">
                    <div class="rankings-header">
                        <h2>üèÜ Leaderboard</h2>
                        <button class="add-prediction-btn" onclick="openModal()">
                            <span>+</span>
                            Add
                        </button>
                    </div>
                    <div id="predictionsList" class="predictions-list">
                        <p style="color: #999; text-align: center;">No predictions yet. Be the first to predict!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Prediction Modal -->
    <div id="predictionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üéØ Enter Your Prediction</h2>
                <button class="close-btn" onclick="closeModal()">√ó</button>
            </div>
            <form class="prediction-form" onsubmit="addPrediction(event)">
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="playerName" required placeholder="e.g. John Doe">
                </div>

                <div class="score-inputs">
                    <div class="form-group">
                        <label>Seahawks Score</label>
                        <input type="number" id="seahawksPrediction" required min="0" max="99" placeholder="e.g. 28">
                    </div>

                    <div class="form-group">
                        <label>Patriots Score</label>
                        <input type="number" id="patriotsPrediction" required min="0" max="99" placeholder="e.g. 24">
                    </div>
                </div>

                <button type="submit" class="btn">Add Prediction</button>
            </form>
        </div>
    </div>

    <!-- Info Modal -->
    <div id="infoModal" class="modal">
        <div class="modal-content info-modal-content">
            <div class="modal-header">
                <h2>üèà How to Play</h2>
                <button class="close-btn" onclick="closeInfoModal()">√ó</button>
            </div>

            <div class="teams-info">
                <div class="team-info-item">
                    <img src="https://a.espncdn.com/i/teamlogos/nfl/500/scoreboard/sea.png" alt="Seahawks" style="width: 60px;">
                    <strong>Seahawks</strong>
                </div>
                <span style="font-size: 1.5em; color: #5a6c7d;">VS</span>
                <div class="team-info-item">
                    <img src="https://a.espncdn.com/i/teamlogos/nfl/500/scoreboard/ne.png" alt="Patriots" style="width: 60px;">
                    <strong>Patriots</strong>
                </div>
            </div>

            <h3>üìã Game Rules</h3>
            <p>Predict the final score of Super Bowl LX and compete with your friends and family!</p>

            <h3>üéØ How to Win</h3>
            <ul>
                <li><strong>1st Priority:</strong> Predict the winning team correctly!</li>
                <li><strong>2nd Priority:</strong> Lowest score error</li>
                <li>Score error = Total difference from actual scores</li>
            </ul>

            <h3>üì± How It Works</h3>
            <ul>
                <li>Click "+ Add" to enter your prediction</li>
                <li>Live scores update every 60 seconds</li>
                <li>Rankings update automatically during the game</li>
                <li>When you take the lead, confetti celebration! üéâ</li>
            </ul>

            <h3>‚öôÔ∏è Manual Override</h3>
            <p>If live scores aren't working, you can manually update scores in the left panel.</p>

            <p style="margin-top: 20px; text-align: center; color: #999;">
                <strong>Game starts: February 8, 2026 at 6:30 PM EST</strong>
            </p>
        </div>
    </div>

    <script>
        let predictions = [];
        let currentScore = { seahawks: null, patriots: null };
        let lastApiError = null;
        let lastUpdateTime = null;
        let previousWinner = null;
        let isModalOpen = false;
        let scoreMode = 'auto';
        let apiInterval = null;
        let gameInfo = {
            quarter: null,
            clock: null,
            status: null
        };

        // Load saved predictions
        function loadPredictions() {
            const saved = localStorage.getItem('superbowlPredictions');
            if (saved) {
                predictions = JSON.parse(saved);
                renderPredictions();
            }
        }

        // Save predictions
        function savePredictions() {
            localStorage.setItem('superbowlPredictions', JSON.stringify(predictions));
        }

        // Delete prediction
        function deletePrediction(index) {
            if (confirm('Are you sure you want to delete this prediction?')) {
                predictions.splice(index, 1);
                savePredictions();
                renderPredictions();
            }
        }

        // Toggle dropdown menu
        function toggleMenu(index) {
            const menu = document.getElementById(`menu-${index}`);
            const allMenus = document.querySelectorAll('.dropdown-menu');

            // Close all other menus
            allMenus.forEach((m, i) => {
                if (m.id !== `menu-${index}`) {
                    m.classList.remove('show');
                }
            });

            menu.classList.toggle('show');
        }

        // Close menus when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.menu-btn') && !event.target.closest('.dropdown-menu')) {
                document.querySelectorAll('.dropdown-menu').forEach(menu => {
                    menu.classList.remove('show');
                });
            }
        });

        // Confetti effect
        function celebrateNewLeader() {
            const duration = 3000;
            const animationEnd = Date.now() + duration;
            const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 2000 };

            function randomInRange(min, max) {
                return Math.random() * (max - min) + min;
            }

            const interval = setInterval(function() {
                const timeLeft = animationEnd - Date.now();

                if (timeLeft <= 0) {
                    return clearInterval(interval);
                }

                const particleCount = 50 * (timeLeft / duration);

                // Multiple confetti bursts from different positions
                confetti(Object.assign({}, defaults, {
                    particleCount,
                    origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 }
                }));
                confetti(Object.assign({}, defaults, {
                    particleCount,
                    origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 }
                }));
            }, 250);
        }

        // Check if winner changed
        function checkWinnerChange(currentWinnerName) {
            if (previousWinner && previousWinner !== currentWinnerName && currentWinnerName) {
                celebrateNewLeader();
            }
            previousWinner = currentWinnerName;
        }

        // Modal functions
        function openModal() {
            isModalOpen = true;
            document.getElementById('predictionModal').classList.add('active');
        }

        function closeModal() {
            // Check if there's any input in the form
            const name = document.getElementById('playerName').value.trim();
            const seahawks = document.getElementById('seahawksPrediction').value;
            const patriots = document.getElementById('patriotsPrediction').value;

            const hasInput = name || seahawks || patriots;

            // If there's input, confirm before closing
            if (hasInput) {
                if (!confirm('You have unsaved input. Are you sure you want to close?')) {
                    return; // Don't close if user cancels
                }
            }

            isModalOpen = false;
            document.getElementById('predictionModal').classList.remove('active');

            // Reset form when closing
            document.querySelector('.prediction-form').reset();
        }

        function openInfoModal() {
            document.getElementById('infoModal').classList.add('active');
        }

        function closeInfoModal() {
            document.getElementById('infoModal').classList.remove('active');
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const predictionModal = document.getElementById('predictionModal');
            const infoModal = document.getElementById('infoModal');

            if (event.target === predictionModal) {
                closeModal();
            } else if (event.target === infoModal) {
                closeInfoModal();
            }
        }

        // Add prediction
        function addPrediction(event) {
            event.preventDefault();

            const seahawksScore = parseInt(document.getElementById('seahawksPrediction').value);
            const patriotsScore = parseInt(document.getElementById('patriotsPrediction').value);

            // Super Bowl cannot end in a tie
            if (seahawksScore === patriotsScore) {
                alert('Super Bowl cannot end in a tie! Please enter different scores.');
                return;
            }

            // Automatically determine winning team from scores
            const winningTeam = seahawksScore > patriotsScore ? 'Seahawks' : 'Patriots';

            const prediction = {
                name: document.getElementById('playerName').value,
                winningTeam: winningTeam,
                seahawksScore: seahawksScore,
                patriotsScore: patriotsScore,
                timestamp: new Date().toISOString()
            };

            predictions.push(prediction);
            savePredictions();
            renderPredictions();

            // Reset form
            event.target.reset();

            // Close modal
            closeModal();
        }

        // Toggle score mode
        function toggleScoreMode() {
            if (scoreMode === 'auto') {
                setScoreMode('manual');
            } else {
                setScoreMode('auto');
            }
        }

        // Set score mode
        function setScoreMode(mode) {
            scoreMode = mode;
            const manualScore = document.querySelector('.manual-score');
            const gameInfo = document.querySelector('.game-info');
            const lastUpdate = document.getElementById('lastUpdate');
            const switchBtn = document.getElementById('manualSwitchBtn');

            if (mode === 'manual') {
                // Stop API calls
                if (apiInterval) {
                    clearInterval(apiInterval);
                    apiInterval = null;
                }
                updateApiStatus('loading', 'Manual mode - API paused');

                // Update button text
                if (switchBtn) switchBtn.textContent = 'Switch back to Auto';

                // Show manual score input, hide game info and last update
                if (manualScore) manualScore.classList.add('active');
                if (gameInfo) gameInfo.style.display = 'none';
                if (lastUpdate) lastUpdate.style.display = 'none';
            } else {
                // Resume API calls
                if (!apiInterval) {
                    fetchLiveScore(); // Fetch immediately
                    apiInterval = setInterval(fetchLiveScore, 60000);
                }

                // Update button text
                if (switchBtn) switchBtn.textContent = 'Having trouble? Enter manual';

                // Hide manual score input, show game info and last update
                if (manualScore) manualScore.classList.remove('active');
                if (gameInfo) gameInfo.style.display = 'flex';
                if (lastUpdate) lastUpdate.style.display = 'inline';
            }
        }

        // Fetch live score from ESPN API
        async function fetchLiveScore() {
            // Skip if modal is open (user is entering prediction)
            if (isModalOpen) {
                console.log('Modal is open, skipping API call');
                return;
            }

            // Skip if manual mode
            if (scoreMode === 'manual') {
                console.log('Manual mode, skipping API call');
                return;
            }

            // Update status to loading
            updateApiStatus('loading', 'Fetching live score...');

            try {
                // Super Bowl date: 2026-02-08
                const response = await fetch('https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard');
                const data = await response.json();

                // Find Super Bowl game (Seahawks vs Patriots)
                const game = data.events.find(event => {
                    const teams = event.competitions[0].competitors;
                    const teamNames = teams.map(t => t.team.abbreviation);
                    return (teamNames.includes('SEA') && teamNames.includes('NE'));
                });

                if (game) {
                    const competitors = game.competitions[0].competitors;
                    const seahawks = competitors.find(c => c.team.abbreviation === 'SEA');
                    const patriots = competitors.find(c => c.team.abbreviation === 'NE');

                    currentScore.seahawks = parseInt(seahawks.score);
                    currentScore.patriots = parseInt(patriots.score);

                    // Update game info
                    gameInfo.quarter = game.status.period;
                    gameInfo.clock = game.status.displayClock;
                    gameInfo.status = game.status.type;

                    updateScoreDisplay();
                    updateGameInfo();

                    // Update last update time
                    lastUpdateTime = new Date();
                    updateApiStatus('success', 'Live score updated');

                    if (lastApiError) {
                        document.getElementById('apiError').innerHTML = '';
                        lastApiError = null;
                    }
                } else {
                    throw new Error('Super Bowl game not found');
                }
            } catch (error) {
                console.error('Failed to fetch live score:', error);
                updateApiStatus('error', 'Failed to fetch live score');

                if (!lastApiError) {
                    lastApiError = error;
                    document.getElementById('apiError').innerHTML = `
                        <div class="error-message">
                            <span>‚ö†Ô∏è Unable to fetch live score.</span>
                            <button class="retry-btn" onclick="retryFetchScore()">Retry</button>
                            <span>or enter scores manually below.</span>
                        </div>
                    `;
                }
            }
        }

        // Retry fetching live score
        function retryFetchScore() {
            lastApiError = null;
            document.getElementById('apiError').innerHTML = '';
            fetchLiveScore();
        }

        // Update score display
        function updateScoreDisplay() {
            document.getElementById('seahawksScore').textContent =
                currentScore.seahawks !== null ? currentScore.seahawks : '-';
            document.getElementById('patriotsScore').textContent =
                currentScore.patriots !== null ? currentScore.patriots : '-';

            renderPredictions();
        }

        // Update game info
        function updateGameInfo() {
            // Quarter
            const quarterEl = document.getElementById('quarterInfo');
            if (gameInfo.quarter > 0) {
                if (gameInfo.quarter <= 4) {
                    const quarters = ['1st', '2nd', '3rd', '4th'];
                    quarterEl.textContent = quarters[gameInfo.quarter - 1];
                } else {
                    quarterEl.textContent = `OT${gameInfo.quarter - 4}`;
                }
            } else {
                quarterEl.textContent = '-';
            }

            // Clock
            const clockEl = document.getElementById('clockInfo');
            clockEl.textContent = gameInfo.clock || '-';

            // Detailed status
            const statusEl = document.getElementById('detailedStatus');
            const statusItem = statusEl.closest('.info-item');
            const statusSeparator = statusItem ? statusItem.previousElementSibling : null;

            if (gameInfo.status) {
                if (gameInfo.status.completed) {
                    statusEl.textContent = 'Final';
                    if (statusItem) statusItem.style.display = 'flex';
                    if (statusSeparator && statusSeparator.classList.contains('info-separator')) {
                        statusSeparator.style.display = 'inline';
                    }
                } else if (gameInfo.status.state === 'in') {
                    // Hide status when Live (Quarter and Clock already show game is in progress)
                    if (statusItem) statusItem.style.display = 'none';
                    if (statusSeparator && statusSeparator.classList.contains('info-separator')) {
                        statusSeparator.style.display = 'none';
                    }
                } else {
                    statusEl.textContent = 'Scheduled';
                    if (statusItem) statusItem.style.display = 'flex';
                    if (statusSeparator && statusSeparator.classList.contains('info-separator')) {
                        statusSeparator.style.display = 'inline';
                    }
                }
            }
        }

        // Update API status indicator
        function updateApiStatus(status, message) {
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('apiStatusText');
            const lastUpdate = document.getElementById('lastUpdate');

            indicator.className = 'status-indicator';

            if (status === 'success') {
                indicator.classList.add('status-success');
                statusText.textContent = message || 'Connected';
            } else if (status === 'loading') {
                indicator.classList.add('status-loading');
                statusText.textContent = message || 'Loading...';
            } else if (status === 'error') {
                indicator.classList.add('status-error');
                statusText.textContent = message || 'Connection error';
            }

            // Update last update time
            if (lastUpdateTime) {
                const now = new Date();
                const diffSeconds = Math.floor((now - lastUpdateTime) / 1000);

                if (diffSeconds < 60) {
                    lastUpdate.textContent = `Updated ${diffSeconds}s ago`;
                } else {
                    const diffMinutes = Math.floor(diffSeconds / 60);
                    lastUpdate.textContent = `Updated ${diffMinutes}m ago`;
                }
            }
        }

        // Update last update time periodically
        setInterval(() => {
            if (lastUpdateTime) {
                const now = new Date();
                const diffSeconds = Math.floor((now - lastUpdateTime) / 1000);
                const lastUpdate = document.getElementById('lastUpdate');

                if (diffSeconds < 60) {
                    lastUpdate.textContent = `Updated ${diffSeconds}s ago`;
                } else {
                    const diffMinutes = Math.floor(diffSeconds / 60);
                    lastUpdate.textContent = `Updated ${diffMinutes}m ago`;
                }
            }
        }, 1000);

        // Update manual score
        function updateManualScore() {
            const seahawks = document.getElementById('manualSeahawks').value;
            const patriots = document.getElementById('manualPatriots').value;

            if (seahawks !== '' && patriots !== '') {
                currentScore.seahawks = parseInt(seahawks);
                currentScore.patriots = parseInt(patriots);
                updateScoreDisplay();
            }
        }

        // Calculate difference
        function calculateDifference(prediction) {
            if (currentScore.seahawks === null || currentScore.patriots === null) {
                return null;
            }

            const actualWinner = currentScore.seahawks > currentScore.patriots ? 'Seahawks' :
                                currentScore.patriots > currentScore.seahawks ? 'Patriots' : 'Tie';

            const predictedWinner = prediction.seahawksScore > prediction.patriotsScore ? 'Seahawks' :
                                   prediction.patriotsScore > prediction.seahawksScore ? 'Patriots' : 'Tie';

            // Check if winner is correct
            const correctWinner = actualWinner === predictedWinner;

            // Calculate how close to exact score
            const seahawksError = Math.abs(currentScore.seahawks - prediction.seahawksScore);
            const patriotsError = Math.abs(currentScore.patriots - prediction.patriotsScore);
            const totalScoreError = seahawksError + patriotsError;

            return {
                correctWinner,
                totalScoreError,
                score: correctWinner ? (1000 - totalScoreError) : (0 - totalScoreError * 2)
            };
        }

        // Render predictions
        function renderPredictions() {
            const container = document.getElementById('predictionsList');
            const addBtn = document.querySelector('.add-prediction-btn');

            if (predictions.length === 0) {
                // Hide header add button when empty
                if (addBtn) addBtn.style.display = 'none';

                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üéØ</div>
                        <h3>No Predictions Yet</h3>
                        <p>Be the first to predict the Super Bowl score!</p>
                        <button class="empty-state-btn" onclick="openModal()">
                            Make Your Prediction
                        </button>
                    </div>
                `;
                return;
            }

            // Show header add button when there are predictions
            if (addBtn) addBtn.style.display = 'flex';

            // Calculate scores and sort
            const predictionsWithScores = predictions.map(p => ({
                ...p,
                result: calculateDifference(p)
            }));

            if (currentScore.seahawks !== null && currentScore.patriots !== null) {
                predictionsWithScores.sort((a, b) => {
                    if (b.result.score !== a.result.score) {
                        return b.result.score - a.result.score;
                    }
                    return a.result.totalScoreError - b.result.totalScoreError;
                });
            }

            const hasScore = currentScore.seahawks !== null && currentScore.patriots !== null;
            const isScoreTied = hasScore && currentScore.seahawks === 0 && currentScore.patriots === 0;
            const winner = hasScore && !isScoreTied && predictionsWithScores.length > 0 ? predictionsWithScores[0] : null;

            // Check if winner changed and trigger confetti
            if (winner) {
                checkWinnerChange(winner.name);
            }

            container.innerHTML = predictionsWithScores.map((p, index) => {
                const isWinner = hasScore && winner && p.name === winner.name;

                let detailsInfo = '';
                if (hasScore && p.result) {
                    const diff = p.seahawksScore > p.patriotsScore ?
                        `${p.winningTeam} wins by ${Math.abs(p.seahawksScore - p.patriotsScore)} pts` :
                        p.patriotsScore > p.seahawksScore ?
                        `${p.winningTeam} wins by ${Math.abs(p.seahawksScore - p.patriotsScore)} pts` :
                        'Tie predicted';

                    // Check if actual game is a Tie
                    const actualIsTie = currentScore.seahawks === currentScore.patriots;
                    // Don't show checkmark if actual game is a Tie
                    const correctIndicator = actualIsTie ? '' : (p.result.correctWinner ? '‚úÖ' : '‚ùå');
                    const separator = correctIndicator ? ' ' : '';
                    detailsInfo = `
                        <div class="prediction-details">
                            ${correctIndicator}${separator}${diff} | Score error: ${p.result.totalScoreError} pts
                        </div>
                    `;
                } else {
                    const diff = p.seahawksScore > p.patriotsScore ?
                        `${p.winningTeam} wins by ${Math.abs(p.seahawksScore - p.patriotsScore)} pts` :
                        p.patriotsScore > p.seahawksScore ?
                        `${p.winningTeam} wins by ${Math.abs(p.seahawksScore - p.patriotsScore)} pts` :
                        'Tie predicted';

                    detailsInfo = `
                        <div class="prediction-details">
                            ${diff}
                        </div>
                    `;
                }

                return `
                    <div class="prediction-item ${isWinner ? 'winner' : ''}" style="animation-delay: ${index * 0.08}s">
                        <div class="prediction-info">
                            <div class="prediction-name">
                                ${index + 1}. ${p.name}
                                ${isWinner ? '<span class="winner-badge">üèÜ Winner</span>' : ''}
                            </div>
                            <div class="prediction-details">
                                Prediction: Seahawks ${p.seahawksScore} - ${p.patriotsScore} Patriots
                            </div>
                            ${detailsInfo}
                        </div>
                        <button class="menu-btn" onclick="toggleMenu(${index}); event.stopPropagation();">‚ãÆ</button>
                        <div id="menu-${index}" class="dropdown-menu">
                            <button class="dropdown-item" onclick="deletePrediction(${index}); event.stopPropagation();">Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Initialize
        loadPredictions();
        fetchLiveScore();

        // Update live score every 60 seconds (only in auto mode)
        apiInterval = setInterval(fetchLiveScore, 60000);
    </script>
</body>
</html>